package org.ekstep.itemset.handler;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.ekstep.common.mgr.ConvertToGraphNode;
import org.ekstep.graph.dac.model.Node;
import org.ekstep.graph.dac.model.Relation;
import org.ekstep.graph.engine.common.GraphEngineTestSetup;
import org.ekstep.graph.model.node.DefinitionDTO;
import org.ekstep.learning.util.ControllerUtil;
import org.junit.AfterClass;
import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.powermock.api.mockito.PowerMockito;
import org.powermock.core.classloader.annotations.PowerMockIgnore;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.PowerMockRunner;


import java.io.File;
import java.io.IOException;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

@RunWith(PowerMockRunner.class)
@PrepareForTest({QuestionPaperGeneratorUtil.class})
@PowerMockIgnore({"javax.management.*", "sun.security.ssl.*", "javax.net.ssl.*" , "javax.crypto.*"})
public class QuestionPaperGeneratorTest extends GraphEngineTestSetup{

    ObjectMapper mapper = new ObjectMapper();
    
    
    @BeforeClass
    public static void create() throws Exception {
    		loadDefinition("definitions/content_definition.json", "definitions/item_definition.json",
    				"definitions/itemset_definition.json");
    	}

    @AfterClass
    public static void destroy() {

    }

    @Test
    public void testGetFileName() {
        String fileName = QuestionPaperGenerator.getFileName("html_");
        Assert.assertNotNull(fileName);
    }

    @Test
    public void testGenerateQuestionPaper() throws Exception{
    		
    		String itemSet = "{\"id\":986983,\"graphId\":\"domain\",\"identifier\":\"do_11292667205373132811\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"ItemSet\",\"metadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"},\"outRelations\":[{\"id\":824419,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11292667205373132811\",\"endNodeId\":\"test.mcq_test_mcq_101\",\"startNodeName\":\"Akshara Worksheet Grade 5 Item Set\",\"endNodeName\":\"Mmcq Question 2\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"IL_UNIQUE_ID\":\"do_11292667205373132811\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"test.mcq_misxed_115\",\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"partial_scoring\":false,\"title\":\"ಈ ಚaಿತ್ರದ ವಿಸ್xsxxxxxxxxxxxxತೀರ್ಣವನ್ನುzsaZZ ಹಾಗೂ ಸುತ್ತಳತೆಯನ್ನು ಲೆಕ್ಕ ಮಾಡಿ.  ಸೂಕ್ತ ಉತ್ತರವನ್ನು ಆರಿಸಿರಿ.\",\"type\":\"mcq\",\"createdOn\":\"2020-01-02T16:28:15.005+0530\",\"feedback\":\"\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"outRelations\":\"[{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"},{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"}]\",\"lastUpdatedOn\":\"2020-01-02T16:28:15.005+0530\",\"model\":\"{\\\"img\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"persximeter\\\"},\\\"img2\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"smallssssssSquare\\\"},\\\"subtext\\\":\\\"(          = 1  ಚದರ ಸೆಂ.ಮೀ)\\\"}\",\"owner\":\"username_2\",\"lastStatusChangedOn\":\"2020-01-02T16:28:15.005+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":1,\"tags\":[\"english\",\"hindi\"],\"versionKey\":\"1577962695005\",\"framework\":\"NCF\",\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"Mmcq Question 2\",\"responses\":\"[{\\\"values\\\":{\\\"12&10\\\":true},\\\"score\\\":1}]\",\"num_answers\":2,\"template_id\":\"mcq_mmtemplate_2\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"test.mcq_test_mcq_101\",\"status\":\"Live\"}}],\"inRelations\":[{\"id\":824398,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11292666508456755211\",\"endNodeId\":\"do_11292667205373132811\",\"startNodeName\":\"Test_PDF\",\"endNodeName\":\"Akshara Worksheet Grade 5 Item Set\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"Content\",\"endNodeObjectType\":\"ItemSet\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"ownershipType\":[\"createdBy\"],\"publish_type\":\"public\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/1_1577963911728.pdf\",\"code\":\"Test_PDF\",\"publishError\":\"Error During Itemset Publish. Please Try Again After Sometime!\",\"downloadUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/ecar_files/do_11292666508456755211/test_pdf_1578314256565_do_11292666508456755211_21.0.ecar\",\"channel\":\"channel-1\",\"language\":[\"English\"],\"variants\":\"{\\\"spine\\\":{\\\"ecarUrl\\\":\\\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/ecar_files/do_11292666508456755211/test_pdf_1578314257331_do_11292666508456755211_21.0_spine.ecar\\\",\\\"size\\\":2088.0}}\",\"mimeType\":\"application/pdf\",\"streamingUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/1_1577963911728.pdf\",\"idealScreenSize\":\"normal\",\"createdOn\":\"2020-01-02T16:17:28.138+0530\",\"contentDisposition\":\"inline\",\"artifactUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/1_1577963911728.pdf\",\"contentEncoding\":\"identity\",\"lastUpdatedOn\":\"2020-01-07T12:34:39.496+0530\",\"SYS_INTERNAL_LAST_UPDATED_ON\":\"2020-01-06T18:07:38.351+0530\",\"contentType\":\"Resource\",\"dialcodeRequired\":\"No\",\"lastUpdatedBy\":\"Ekstep\",\"audience\":[\"Learner\"],\"lastStatusChangedOn\":\"2020-01-06T18:44:48.759+0530\",\"os\":[\"All\"],\"visibility\":\"Default\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"mediaType\":\"content\",\"osId\":\"org.ekstep.quiz.app\",\"lastPublishedBy\":\"Ekstep\",\"version\":2,\"pkgVersion\":21.0,\"pragma\":[\"external\"],\"versionKey\":\"1578380679496\",\"idealScreenDensity\":\"hdpi\",\"license\":\"Creative Commons Attribution (CC BY)\",\"framework\":\"NCF\",\"s3Key\":\"ecar_files/do_11292666508456755211/test_pdf_1578314256565_do_11292666508456755211_21.0.ecar\",\"lastPublishedOn\":\"2020-01-06T18:07:36.315+0530\",\"size\":413860.0,\"compatibilityLevel\":4,\"IL_FUNC_OBJECT_TYPE\":\"Content\",\"name\":\"Test_PDF\",\"publisher\":\"EkStep\",\"itemSetPreviewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/do_11292666508456755211_1578314178385.html\",\"IL_UNIQUE_ID\":\"do_11292666508456755211\",\"status\":\"Failed\"},\"endNodeMetadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"IL_UNIQUE_ID\":\"do_11292667205373132811\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"}}],\"tags\":null}";
    		Map<String, Object> nodeMap = mapper.readValue(itemSet, Map.class);
    		DefinitionDTO d = new ControllerUtil().getDefinition("domain", "ItemSet");
    		Node node = ConvertToGraphNode.convertToGraphNode(nodeMap, d, null);
    		Relation r = new Relation("do_11292667205373132811", "hasSequenceMember", "test.mcq_test_mcq_101");
    		Map<String, Object> relationMataData = new HashMap<>();
    		relationMataData.put("IL_SEQUENCE_INDEX", 1);
    		r.setMetadata(relationMataData);
    		r.setStartNodeObjectType("ItemSet");
    		r.setEndNodeObjectType("AssessmentItem");
    		node.setOutRelations(Arrays.asList(r));
    		System.out.println(node.getOutRelations().size());
    		
    		
    		PowerMockito.mockStatic(QuestionPaperGeneratorUtil.class);		
    		try {
    			String questionNodeMapString = "{\"outRelations\":\"[{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"},{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"}]\",\"inRelations\":[{\"id\":824419,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11292667205373132811\",\"endNodeId\":\"test.mcq_test_mcq_101\",\"startNodeName\":\"Akshara Worksheet Grade 5 Item Set\",\"endNodeName\":\"Mmcq Question 2\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"IL_UNIQUE_ID\":\"do_11292667205373132811\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"test.mcq_misxed_115\",\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"partial_scoring\":false,\"title\":\"ಈ ಚaಿತ್ರದ ವಿಸ್xsxxxxxxxxxxxxತೀರ್ಣವನ್ನುzsaZZ ಹಾಗೂ ಸುತ್ತಳತೆಯನ್ನು ಲೆಕ್ಕ ಮಾಡಿ.  ಸೂಕ್ತ ಉತ್ತರವನ್ನು ಆರಿಸಿರಿ.\",\"type\":\"mcq\",\"createdOn\":\"2020-01-02T16:28:15.005+0530\",\"feedback\":\"\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"outRelations\":\"[{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"},{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"}]\",\"lastUpdatedOn\":\"2020-01-02T16:28:15.005+0530\",\"model\":\"{\\\"img\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"persximeter\\\"},\\\"img2\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"smallssssssSquare\\\"},\\\"subtext\\\":\\\"(          = 1  ಚದರ ಸೆಂ.ಮೀ)\\\"}\",\"owner\":\"username_2\",\"lastStatusChangedOn\":\"2020-01-02T16:28:15.005+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":1,\"tags\":[\"english\",\"hindi\"],\"versionKey\":\"1577962695005\",\"framework\":\"NCF\",\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"Mmcq Question 2\",\"responses\":\"[{\\\"values\\\":{\\\"12&10\\\":true},\\\"score\\\":1}]\",\"num_answers\":2,\"template_id\":\"mcq_mmtemplate_2\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"test.mcq_test_mcq_101\",\"status\":\"Live\"}}],\"identifier\":\"test.mcq_test_mcq_101\",\"objectType\":\"AssessmentItem\",\"itemType\":\"UNIT\",\"code\":\"test.mcq_misxed_115\",\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"partial_scoring\":false,\"title\":\"ಈ ಚaಿತ್ರದ ವಿಸ್xsxxxxxxxxxxxxತೀರ್ಣವನ್ನುzsaZZ ಹಾಗೂ ಸುತ್ತಳತೆಯನ್ನು ಲೆಕ್ಕ ಮಾಡಿ.  ಸೂಕ್ತ ಉತ್ತರವನ್ನು ಆರಿಸಿರಿ.\",\"type\":\"mcq\",\"createdOn\":\"2020-01-02T16:28:15.005+0530\",\"feedback\":\"\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-02T16:28:15.005+0530\",\"model\":\"{\\\"img\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"persximeter\\\"},\\\"img2\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"smallssssssSquare\\\"},\\\"subtext\\\":\\\"(          = 1  ಚದರ ಸೆಂ.ಮೀ)\\\"}\",\"owner\":\"username_2\",\"lastStatusChangedOn\":\"2020-01-02T16:28:15.005+0530\",\"version\":1,\"tags\":[\"english\",\"hindi\"],\"versionKey\":\"1577962695005\",\"framework\":\"NCF\",\"max_score\":1,\"name\":\"Mmcq Question 2\",\"responses\":\"[{\\\"values\\\":{\\\"12&10\\\":true},\\\"score\\\":1}]\",\"num_answers\":2,\"template_id\":\"mcq_mmtemplate_2\",\"category\":\"MCQ\",\"status\":\"Live\"}";
        		Map<String, Object> questionNodeMap = mapper.readValue(questionNodeMapString, HashMap.class);
        		d = new ControllerUtil().getDefinition("domain", "AssessmentItem");
        		Node assessmentItemNode = ConvertToGraphNode.convertToGraphNode(questionNodeMap, d, null);
        		Map<String, Object> questionMap = new HashMap<>();
        		questionMap.put("test.mcq_test_mcq_101", assessmentItemNode);
        		PowerMockito.when(QuestionPaperGeneratorUtil.getMetadataFromNeo4j(Mockito.anyList())).thenReturn(questionMap);
        		
        		String questionNodeBodyString = "{\"test.mcq_test_mcq_101\":{\"body\":\"<div class='mcq-vertical cheveron-helper'><div class='mcq-title'><p>Which of the following sets of tests would be LEAST urgently indicated for a patient presenting with intraocular pressures of R 22mmHg and L 46mmHg?</p></div><i class='chevron down icon'></i><div class='mcq-options'><div data-simple-choice-interaction data-response-variable='responseValue' value=0 class='mcq-option'><p>Visual field examination and dilated optic nerve head assessment</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=1 class='mcq-option'><p>Examination of the irides and anterior chamber assessment for cells and flare</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=2 class='mcq-option'><p>Gonioscopy and assessment of the lens capsule</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=3 class='mcq-option'><p>Assessment of the corneal endothelium and iris transillumination</p></div></div></div>\"}}";
        		Map<String, Object> questionBodyMap = mapper.readValue(questionNodeBodyString, HashMap.class);
        		PowerMockito.when(QuestionPaperGeneratorUtil.getExternalPropsData(Mockito.anyList())).thenReturn(questionBodyMap);
        		
        		File file = QuestionPaperGenerator.generateQuestionPaper(node);
        		System.out.println(file.getAbsolutePath());
    		}catch(Exception e) {
    			e.printStackTrace();
    		}
    }

    @Test
    public void testFetchChildDetails() throws Exception {
    	String itemSet = "{\"id\":986983,\"graphId\":\"domain\",\"identifier\":\"do_11292667205373132811\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"ItemSet\",\"metadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"},\"outRelations\":[{\"id\":824419,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11292667205373132811\",\"endNodeId\":\"test.mcq_test_mcq_101\",\"startNodeName\":\"Akshara Worksheet Grade 5 Item Set\",\"endNodeName\":\"Mmcq Question 2\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"IL_UNIQUE_ID\":\"do_11292667205373132811\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"test.mcq_misxed_115\",\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"partial_scoring\":false,\"title\":\"ಈ ಚaಿತ್ರದ ವಿಸ್xsxxxxxxxxxxxxತೀರ್ಣವನ್ನುzsaZZ ಹಾಗೂ ಸುತ್ತಳತೆಯನ್ನು ಲೆಕ್ಕ ಮಾಡಿ.  ಸೂಕ್ತ ಉತ್ತರವನ್ನು ಆರಿಸಿರಿ.\",\"type\":\"mcq\",\"createdOn\":\"2020-01-02T16:28:15.005+0530\",\"feedback\":\"\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"outRelations\":\"[{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"},{\\\"endNodeId\\\":\\\"Num:C1:SC1\\\",\\\"relationType\\\":\\\"associatedTo\\\"}]\",\"lastUpdatedOn\":\"2020-01-02T16:28:15.005+0530\",\"model\":\"{\\\"img\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"persximeter\\\"},\\\"img2\\\":{\\\"type\\\":\\\"image\\\",\\\"asset\\\":\\\"smallssssssSquare\\\"},\\\"subtext\\\":\\\"(          = 1  ಚದರ ಸೆಂ.ಮೀ)\\\"}\",\"owner\":\"username_2\",\"lastStatusChangedOn\":\"2020-01-02T16:28:15.005+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":1,\"tags\":[\"english\",\"hindi\"],\"versionKey\":\"1577962695005\",\"framework\":\"NCF\",\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"Mmcq Question 2\",\"responses\":\"[{\\\"values\\\":{\\\"12&10\\\":true},\\\"score\\\":1}]\",\"num_answers\":2,\"template_id\":\"mcq_mmtemplate_2\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"test.mcq_test_mcq_101\",\"status\":\"Live\"}}],\"inRelations\":[{\"id\":824398,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11292666508456755211\",\"endNodeId\":\"do_11292667205373132811\",\"startNodeName\":\"Test_PDF\",\"endNodeName\":\"Akshara Worksheet Grade 5 Item Set\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"Content\",\"endNodeObjectType\":\"ItemSet\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"ownershipType\":[\"createdBy\"],\"publish_type\":\"public\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/1_1577963911728.pdf\",\"code\":\"Test_PDF\",\"publishError\":\"Error During Itemset Publish. Please Try Again After Sometime!\",\"downloadUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/ecar_files/do_11292666508456755211/test_pdf_1578314256565_do_11292666508456755211_21.0.ecar\",\"channel\":\"channel-1\",\"language\":[\"English\"],\"variants\":\"{\\\"spine\\\":{\\\"ecarUrl\\\":\\\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/ecar_files/do_11292666508456755211/test_pdf_1578314257331_do_11292666508456755211_21.0_spine.ecar\\\",\\\"size\\\":2088.0}}\",\"mimeType\":\"application/pdf\",\"streamingUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/1_1577963911728.pdf\",\"idealScreenSize\":\"normal\",\"createdOn\":\"2020-01-02T16:17:28.138+0530\",\"contentDisposition\":\"inline\",\"artifactUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/1_1577963911728.pdf\",\"contentEncoding\":\"identity\",\"lastUpdatedOn\":\"2020-01-07T12:34:39.496+0530\",\"SYS_INTERNAL_LAST_UPDATED_ON\":\"2020-01-06T18:07:38.351+0530\",\"contentType\":\"Resource\",\"dialcodeRequired\":\"No\",\"lastUpdatedBy\":\"Ekstep\",\"audience\":[\"Learner\"],\"lastStatusChangedOn\":\"2020-01-06T18:44:48.759+0530\",\"os\":[\"All\"],\"visibility\":\"Default\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"mediaType\":\"content\",\"osId\":\"org.ekstep.quiz.app\",\"lastPublishedBy\":\"Ekstep\",\"version\":2,\"pkgVersion\":21.0,\"pragma\":[\"external\"],\"versionKey\":\"1578380679496\",\"idealScreenDensity\":\"hdpi\",\"license\":\"Creative Commons Attribution (CC BY)\",\"framework\":\"NCF\",\"s3Key\":\"ecar_files/do_11292666508456755211/test_pdf_1578314256565_do_11292666508456755211_21.0.ecar\",\"lastPublishedOn\":\"2020-01-06T18:07:36.315+0530\",\"size\":413860.0,\"compatibilityLevel\":4,\"IL_FUNC_OBJECT_TYPE\":\"Content\",\"name\":\"Test_PDF\",\"publisher\":\"EkStep\",\"itemSetPreviewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/content/do_11292666508456755211/artifact/do_11292666508456755211_1578314178385.html\",\"IL_UNIQUE_ID\":\"do_11292666508456755211\",\"status\":\"Failed\"},\"endNodeMetadata\":{\"owner\":\"Ilimi\",\"lastStatusChangedOn\":\"2020-01-02T16:31:37.174+0530\",\"code\":\"akshara.grade5.ws1.test\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11292667205373132811/do_11292667205373132811_html_1578314155877.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"channel\":\"in.ekstep\",\"SET_OBJECT_TYPE_KEY\":\"AssessmentItem\",\"description\":\"Akshara Worksheet Grade 5 Item Set\",\"language\":[\"English\"],\"title\":\"Akshara Worksheet Grade 5 Item Set\",\"type\":\"materialised\",\"total_items\":1,\"createdOn\":\"2020-01-02T16:31:37.174+0530\",\"versionKey\":\"1578314159042\",\"gradeLevel\":[\"Grade 1\"],\"max_score\":1,\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"lastUpdatedOn\":\"2020-01-06T18:05:59.042+0530\",\"used_for\":\"assessment\",\"items\":\"[{\\\"identifier\\\":\\\"test.mcq_test_mcq_101\\\"}]\",\"IL_UNIQUE_ID\":\"do_11292667205373132811\",\"SET_TYPE\":\"MATERIALISED_SET\",\"status\":\"Live\"}}],\"tags\":null}";
		Map<String, Object> nodeMap = mapper.readValue(itemSet, Map.class);
		DefinitionDTO d = new ControllerUtil().getDefinition("domain", "ItemSet");
		Node node = ConvertToGraphNode.convertToGraphNode(nodeMap, d, null);
		Relation r = new Relation("do_11292667205373132811", "hasSequenceMember", "test.mcq_test_mcq_101");
		Map<String, Object> relationMataData = new HashMap<>();
		relationMataData.put("IL_SEQUENCE_INDEX", 1);
		r.setMetadata(relationMataData);
		r.setStartNodeObjectType("ItemSet");
		r.setEndNodeObjectType("AssessmentItem");
		node.setOutRelations(Arrays.asList(r));
		System.out.println(node.getOutRelations().size());
		Map<String, Object> o = QuestionPaperGenerator.fetchChildDetails(node);
		Assert.assertNotNull(o);
    }
    
    //Validate complete valid scenario
    @Test
    public void testGetAssessmentDataMap1() throws JsonParseException, JsonMappingException, IOException {
    		
    		PowerMockito.mockStatic(QuestionPaperGeneratorUtil.class);
    	
    		String do_11293645874324275213NodeString = "{\"id\":986986,\"graphId\":\"domain\",\"identifier\":\"do_11293645874324275213\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"AssessmentItem\",\"metadata\":{\"itemType\":\"UNIT\",\"lastStatusChangedOn\":\"2020-01-16T12:22:41.396+0530\",\"creator\":\"contentcreator\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"string\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"Anwser Data\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"NA\",\"type\":\"reference\",\"createdOn\":\"2020-01-16T12:22:41.396+0530\",\"version\":3,\"versionKey\":\"1579157561396\",\"framework\":\"NCF\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\"},\\\"answer\\\":true}]\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"lastUpdatedOn\":\"2020-01-16T12:22:41.396+0530\",\"category\":\"CuriosityQuestion\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"},\"outRelations\":[],\"inRelations\":[{\"id\":824422,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11293646884701798412\",\"endNodeId\":\"do_11293645874324275213\",\"startNodeName\":\"Question Paper\",\"endNodeName\":\"MCQ_ekstep_ncert_k-12\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":3},\"startNodeMetadata\":{\"lastStatusChangedOn\":\"2020-01-16T15:44:59.863+0530\",\"code\":\"question\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11293646884701798412/do_11293646884701798412_html_1579171353875.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"prevStatus\":\"Draft\",\"language\":[\"English\"],\"maxScore\":10,\"type\":\"materialised\",\"createdOn\":\"2020-01-16T12:43:17.728+0530\",\"version\":2,\"versionKey\":\"1579171354221\",\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"name\":\"Question Paper\",\"lastUpdatedOn\":\"2020-01-16T16:12:34.221+0530\",\"IL_UNIQUE_ID\":\"do_11293646884701798412\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"string\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"Anwser Data\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"NA\",\"type\":\"reference\",\"createdOn\":\"2020-01-16T12:22:41.396+0530\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\"},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-16T12:22:41.396+0530\",\"lastStatusChangedOn\":\"2020-01-16T12:22:41.396+0530\",\"creator\":\"contentcreator\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":3,\"versionKey\":\"1579157561396\",\"framework\":\"NCF\",\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"category\":\"CuriosityQuestion\",\"IL_UNIQUE_ID\":\"do_11293645874324275213\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"}}],\"tags\":null}";
    		Node do_11293645874324275213Node = mapper.readValue(do_11293645874324275213NodeString, Node.class);
    		String do_11293645447181107211NodeString = "{\"id\":986984,\"graphId\":\"domain\",\"identifier\":\"do_11293645447181107211\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"AssessmentItem\",\"metadata\":{\"itemType\":\"UNIT\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:13:59.816+0530\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:13:59.816+0530\",\"version\":3,\"versionKey\":\"1579157039816\",\"framework\":\"NCF\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"lastUpdatedOn\":\"2020-01-16T12:13:59.816+0530\",\"category\":\"MCQ\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"},\"outRelations\":[],\"inRelations\":[{\"id\":824420,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11293646884701798412\",\"endNodeId\":\"do_11293645447181107211\",\"startNodeName\":\"Question Paper\",\"endNodeName\":\"MCQ_ekstep_ncert_k-12\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"lastStatusChangedOn\":\"2020-01-16T15:44:59.863+0530\",\"code\":\"question\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11293646884701798412/do_11293646884701798412_html_1579171353875.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"prevStatus\":\"Draft\",\"language\":[\"English\"],\"maxScore\":10,\"type\":\"materialised\",\"createdOn\":\"2020-01-16T12:43:17.728+0530\",\"version\":2,\"versionKey\":\"1579171354221\",\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"name\":\"Question Paper\",\"lastUpdatedOn\":\"2020-01-16T16:12:34.221+0530\",\"IL_UNIQUE_ID\":\"do_11293646884701798412\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:13:59.816+0530\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-16T12:13:59.816+0530\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:13:59.816+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":3,\"versionKey\":\"1579157039816\",\"framework\":\"NCF\",\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"do_11293645447181107211\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"}}],\"tags\":null}";
    		Node do_11293645447181107211Node = mapper.readValue(do_11293645447181107211NodeString, Node.class);
    		String do_11293645469885235212NodeString = "{\"id\":986985,\"graphId\":\"domain\",\"identifier\":\"do_11293645469885235212\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"AssessmentItem\",\"metadata\":{\"itemType\":\"UNIT\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:14:27.725+0530\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:14:27.725+0530\",\"version\":3,\"versionKey\":\"1579157067725\",\"framework\":\"NCF\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"lastUpdatedOn\":\"2020-01-16T12:14:27.725+0530\",\"category\":\"MCQ\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"},\"outRelations\":[],\"inRelations\":[{\"id\":824421,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11293646884701798412\",\"endNodeId\":\"do_11293645469885235212\",\"startNodeName\":\"Question Paper\",\"endNodeName\":\"MCQ_ekstep_ncert_k-12\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":2},\"startNodeMetadata\":{\"lastStatusChangedOn\":\"2020-01-16T15:44:59.863+0530\",\"code\":\"question\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11293646884701798412/do_11293646884701798412_html_1579171353875.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"prevStatus\":\"Draft\",\"language\":[\"English\"],\"maxScore\":10,\"type\":\"materialised\",\"createdOn\":\"2020-01-16T12:43:17.728+0530\",\"version\":2,\"versionKey\":\"1579171354221\",\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"name\":\"Question Paper\",\"lastUpdatedOn\":\"2020-01-16T16:12:34.221+0530\",\"IL_UNIQUE_ID\":\"do_11293646884701798412\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:14:27.725+0530\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-16T12:14:27.725+0530\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:14:27.725+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":3,\"versionKey\":\"1579157067725\",\"framework\":\"NCF\",\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"do_11293645469885235212\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"}}],\"tags\":null}";
    		Node do_11293645469885235212Node = mapper.readValue(do_11293645469885235212NodeString, Node.class);
    		
    		Map<String, Object> nodeMap = new HashMap<>();
    		nodeMap.put("do_11293645874324275213", do_11293645874324275213Node);
    		nodeMap.put("do_11293645447181107211", do_11293645447181107211Node);
    		nodeMap.put("do_11293645469885235212", do_11293645469885235212Node);
    		
    		PowerMockito.when(QuestionPaperGeneratorUtil.getMetadataFromNeo4j(Mockito.anyList())).thenReturn(nodeMap);
		
		String externalPropMapString = "{\"do_11293645874324275213\":{\"body\":\"body Data\",\"editorstate\":\"{\\\"question\\\":\\\"question\\\",\\\"answer\\\":\\\"\\\",\\\"solutions\\\":[{\\\"id\\\":\\\"2\\\",\\\"value\\\":\\\"Solution as videoDat\\\",\\\"type\\\":\\\"html/video\\\"}]}\"},\"do_11293645447181107211\":{\"body\":\"<div class='mcq-vertical cheveron-helper'><div class='mcq-title'><p>Alpha</p></div><i class='chevron down icon'></i><div class='mcq-options'><div data-simple-choice-interaction data-response-variable='responseValue' value=0 class='mcq-option'><p>26</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=1 class='mcq-option'><p>24</p></div></div></div>\",\"editorstate\":\"{\\\"question\\\":\\\"question\\\",\\\"options\\\":[{\\\"answer\\\":false,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>26</p>\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"answer\\\":true,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>24</p>\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}}],\\\"solutions\\\":[{\\\"id\\\":\\\"1\\\",\\\"value\\\":\\\"Solution as videoData\\\",\\\"type\\\":\\\"html/video\\\"}]}\"},\"do_11293645469885235212\":{\"body\":\"<div class='mcq-vertical cheveron-helper'><div class='mcq-title'><p>Alpha</p></div><i class='chevron down icon'></i><div class='mcq-options'><div data-simple-choice-interaction data-response-variable='responseValue' value=0 class='mcq-option'><p>26</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=1 class='mcq-option'><p>24</p></div></div></div>\",\"editorstate\":\"{\\\"question\\\":\\\"question\\\",\\\"options\\\":[{\\\"answer\\\":false,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>26</p>\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"answer\\\":true,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>24</p>\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}}],\\\"solutions\\\":[{\\\"id\\\":\\\"1\\\",\\\"value\\\":\\\"Solution as videoData\\\",\\\"type\\\":\\\"html/video\\\"}]}\"}}";
		Map<String, Object> externalPropMap = mapper.readValue(externalPropMapString, Map.class);
		PowerMockito.when(QuestionPaperGeneratorUtil.getExternalPropsData(Mockito.anyList())).thenReturn(externalPropMap);
		
		String childDataString = "{\"do_11293645874324275213\":3,\"do_11293645447181107211\":1,\"do_11293645469885235212\":2}";
		Map<String, Object> childData = mapper.readValue(childDataString, Map.class);
		
		Map<String, Object> assessmentMap = QuestionPaperGenerator.getAssessmentDataMap(childData);
		Assert.assertNotNull(assessmentMap);
		System.out.println(assessmentMap);
    }
    
    // Validate if neo4j getMetadataFromNeo4j return null
    @Test
    public void testGetAssessmentDataMap2() throws JsonParseException, JsonMappingException, IOException {
    		
    		PowerMockito.mockStatic(QuestionPaperGeneratorUtil.class);
    		PowerMockito.when(QuestionPaperGeneratorUtil.getMetadataFromNeo4j(Mockito.anyList())).thenReturn(null);
		
		PowerMockito.when(QuestionPaperGeneratorUtil.getExternalPropsData(Mockito.anyList())).thenReturn(null);
		
		String childDataString = "{\"do_11293645874324275213\":3,\"do_11293645447181107211\":1,\"do_11293645469885235212\":2}";
		Map<String, Object> childData = mapper.readValue(childDataString, Map.class);
		
		Map<String, Object> assessmentMap = QuestionPaperGenerator.getAssessmentDataMap(childData);
		Assert.assertNull(assessmentMap);
		System.out.println(assessmentMap);
    }
    
    // Validate if responseDecleration is not present in node metadata
    @Test
    public void testGetAssessmentDataMap3() throws JsonParseException, JsonMappingException, IOException {
    		
    		PowerMockito.mockStatic(QuestionPaperGeneratorUtil.class);
    	
    		String do_11293645874324275213NodeString = "{\"id\":986986,\"graphId\":\"domain\",\"identifier\":\"do_11293645874324275213\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"AssessmentItem\",\"metadata\":{\"itemType\":\"UNIT\",\"lastStatusChangedOn\":\"2020-01-16T12:22:41.396+0530\",\"creator\":\"contentcreator\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"string\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"Anwser Data\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"NA\",\"type\":\"reference\",\"createdOn\":\"2020-01-16T12:22:41.396+0530\",\"version\":3,\"versionKey\":\"1579157561396\",\"framework\":\"NCF\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\"},\\\"answer\\\":true}]\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"lastUpdatedOn\":\"2020-01-16T12:22:41.396+0530\",\"category\":\"CuriosityQuestion\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"},\"outRelations\":[],\"inRelations\":[{\"id\":824422,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11293646884701798412\",\"endNodeId\":\"do_11293645874324275213\",\"startNodeName\":\"Question Paper\",\"endNodeName\":\"MCQ_ekstep_ncert_k-12\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":3},\"startNodeMetadata\":{\"lastStatusChangedOn\":\"2020-01-16T15:44:59.863+0530\",\"code\":\"question\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11293646884701798412/do_11293646884701798412_html_1579171353875.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"prevStatus\":\"Draft\",\"language\":[\"English\"],\"maxScore\":10,\"type\":\"materialised\",\"createdOn\":\"2020-01-16T12:43:17.728+0530\",\"version\":2,\"versionKey\":\"1579171354221\",\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"name\":\"Question Paper\",\"lastUpdatedOn\":\"2020-01-16T16:12:34.221+0530\",\"IL_UNIQUE_ID\":\"do_11293646884701798412\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"string\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"Anwser Data\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"NA\",\"type\":\"reference\",\"createdOn\":\"2020-01-16T12:22:41.396+0530\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\"}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\"},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-16T12:22:41.396+0530\",\"lastStatusChangedOn\":\"2020-01-16T12:22:41.396+0530\",\"creator\":\"contentcreator\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":3,\"versionKey\":\"1579157561396\",\"framework\":\"NCF\",\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"category\":\"CuriosityQuestion\",\"IL_UNIQUE_ID\":\"do_11293645874324275213\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"}}],\"tags\":null}";
    		Node do_11293645874324275213Node = mapper.readValue(do_11293645874324275213NodeString, Node.class);
    		String do_11293645447181107211NodeString = "{\"id\":986984,\"graphId\":\"domain\",\"identifier\":\"do_11293645447181107211\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"AssessmentItem\",\"metadata\":{\"itemType\":\"UNIT\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:13:59.816+0530\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:13:59.816+0530\",\"version\":3,\"versionKey\":\"1579157039816\",\"framework\":\"NCF\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"lastUpdatedOn\":\"2020-01-16T12:13:59.816+0530\",\"category\":\"MCQ\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"},\"outRelations\":[],\"inRelations\":[{\"id\":824420,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11293646884701798412\",\"endNodeId\":\"do_11293645447181107211\",\"startNodeName\":\"Question Paper\",\"endNodeName\":\"MCQ_ekstep_ncert_k-12\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":1},\"startNodeMetadata\":{\"lastStatusChangedOn\":\"2020-01-16T15:44:59.863+0530\",\"code\":\"question\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11293646884701798412/do_11293646884701798412_html_1579171353875.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"prevStatus\":\"Draft\",\"language\":[\"English\"],\"maxScore\":10,\"type\":\"materialised\",\"createdOn\":\"2020-01-16T12:43:17.728+0530\",\"version\":2,\"versionKey\":\"1579171354221\",\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"name\":\"Question Paper\",\"lastUpdatedOn\":\"2020-01-16T16:12:34.221+0530\",\"IL_UNIQUE_ID\":\"do_11293646884701798412\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:13:59.816+0530\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-16T12:13:59.816+0530\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:13:59.816+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":3,\"versionKey\":\"1579157039816\",\"framework\":\"NCF\",\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"do_11293645447181107211\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"}}],\"tags\":null}";
    		Node do_11293645447181107211Node = mapper.readValue(do_11293645447181107211NodeString, Node.class);
    		String do_11293645469885235212NodeString = "{\"id\":986985,\"graphId\":\"domain\",\"identifier\":\"do_11293645469885235212\",\"nodeType\":\"DATA_NODE\",\"objectType\":\"AssessmentItem\",\"metadata\":{\"itemType\":\"UNIT\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:14:27.725+0530\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:14:27.725+0530\",\"version\":3,\"versionKey\":\"1579157067725\",\"framework\":\"NCF\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"lastUpdatedOn\":\"2020-01-16T12:14:27.725+0530\",\"category\":\"MCQ\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"},\"outRelations\":[],\"inRelations\":[{\"id\":824421,\"graphId\":\"domain\",\"relationType\":\"hasSequenceMember\",\"startNodeId\":\"do_11293646884701798412\",\"endNodeId\":\"do_11293645469885235212\",\"startNodeName\":\"Question Paper\",\"endNodeName\":\"MCQ_ekstep_ncert_k-12\",\"startNodeType\":\"DATA_NODE\",\"endNodeType\":\"DATA_NODE\",\"startNodeObjectType\":\"ItemSet\",\"endNodeObjectType\":\"AssessmentItem\",\"metadata\":{\"IL_SEQUENCE_INDEX\":2},\"startNodeMetadata\":{\"lastStatusChangedOn\":\"2020-01-16T15:44:59.863+0530\",\"code\":\"question\",\"previewUrl\":\"https://sunbirddev.blob.core.windows.net/sunbird-content-dev/itemset/do_11293646884701798412/do_11293646884701798412_html_1579171353875.html\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"prevStatus\":\"Draft\",\"language\":[\"English\"],\"maxScore\":10,\"type\":\"materialised\",\"createdOn\":\"2020-01-16T12:43:17.728+0530\",\"version\":2,\"versionKey\":\"1579171354221\",\"IL_FUNC_OBJECT_TYPE\":\"ItemSet\",\"name\":\"Question Paper\",\"lastUpdatedOn\":\"2020-01-16T16:12:34.221+0530\",\"IL_UNIQUE_ID\":\"do_11293646884701798412\",\"status\":\"Live\"},\"endNodeMetadata\":{\"itemType\":\"UNIT\",\"code\":\"5ea97a7b-cad7-4655-ae97-721a9a6bfeca\",\"qumlVersion\":0.5,\"qlevel\":\"MEDIUM\",\"channel\":\"in.ekstep\",\"organisation\":[\"DPS (Ghaziabad)\"],\"responseDeclaration\":\"{\\\"responseValue\\\":{\\\"cardinality\\\":\\\"single\\\",\\\"type\\\":\\\"integer\\\",\\\"correct_response\\\":{\\\"value\\\":\\\"1\\\"}}}\",\"language\":[\"English\"],\"program\":\"CBSE\",\"templateId\":\"mcq-vertical\",\"type\":\"mcq\",\"createdOn\":\"2020-01-16T12:14:27.725+0530\",\"options\":\"[{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"12&10\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"asset\\\":\\\"14&7\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"text\\\":\\\"16&8\\\",\\\"image\\\":\\\"image1\\\",\\\"audio\\\":\\\"audio1\\\",\\\"resvalue\\\":\\\"16&8\\\",\\\"resindex\\\":2}},{\\\"value\\\":{\\\"type\\\":\\\"mixed\\\",\\\"image\\\":\\\"image2\\\",\\\"audio\\\":\\\"audio2\\\",\\\"resvalue\\\":3,\\\"resindex\\\":3},\\\"answer\\\":true}]\",\"lastUpdatedOn\":\"2020-01-16T12:14:27.725+0530\",\"creator\":\"contentcreator\",\"lastStatusChangedOn\":\"2020-01-16T12:14:27.725+0530\",\"IL_SYS_NODE_TYPE\":\"DATA_NODE\",\"version\":3,\"versionKey\":\"1579157067725\",\"framework\":\"NCF\",\"IL_FUNC_OBJECT_TYPE\":\"AssessmentItem\",\"name\":\"MCQ_ekstep_ncert_k-12\",\"category\":\"MCQ\",\"IL_UNIQUE_ID\":\"do_11293645469885235212\",\"programId\":\"31ab2990-7892-11e9-8a02-93c5c62c03f1\",\"status\":\"Live\"}}],\"tags\":null}";
    		Node do_11293645469885235212Node = mapper.readValue(do_11293645469885235212NodeString, Node.class);
    		
    		Map<String, Object> nodeMap = new HashMap<>();
    		nodeMap.put("do_11293645874324275213", do_11293645874324275213Node);
    		nodeMap.put("do_11293645447181107211", do_11293645447181107211Node);
    		nodeMap.put("do_11293645469885235212", do_11293645469885235212Node);
    		
    		PowerMockito.when(QuestionPaperGeneratorUtil.getMetadataFromNeo4j(Mockito.anyList())).thenReturn(nodeMap);
		
		String externalPropMapString = "{\"do_11293645874324275213\":{\"body\":\"body Data\",\"editorstate\":\"{\\\"question\\\":\\\"question\\\",\\\"answer\\\":\\\"\\\",\\\"solutions\\\":[{\\\"id\\\":\\\"2\\\",\\\"value\\\":\\\"Solution as videoDat\\\",\\\"type\\\":\\\"html/video\\\"}]}\"},\"do_11293645447181107211\":{\"body\":\"<div class='mcq-vertical cheveron-helper'><div class='mcq-title'><p>Alpha</p></div><i class='chevron down icon'></i><div class='mcq-options'><div data-simple-choice-interaction data-response-variable='responseValue' value=0 class='mcq-option'><p>26</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=1 class='mcq-option'><p>24</p></div></div></div>\",\"editorstate\":\"{\\\"question\\\":\\\"question\\\",\\\"options\\\":[{\\\"answer\\\":false,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>26</p>\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"answer\\\":true,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>24</p>\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}}],\\\"solutions\\\":[{\\\"id\\\":\\\"1\\\",\\\"value\\\":\\\"Solution as videoData\\\",\\\"type\\\":\\\"html/video\\\"}]}\"},\"do_11293645469885235212\":{\"body\":\"<div class='mcq-vertical cheveron-helper'><div class='mcq-title'><p>Alpha</p></div><i class='chevron down icon'></i><div class='mcq-options'><div data-simple-choice-interaction data-response-variable='responseValue' value=0 class='mcq-option'><p>26</p></div><div data-simple-choice-interaction data-response-variable='responseValue' value=1 class='mcq-option'><p>24</p></div></div></div>\",\"editorstate\":\"{\\\"question\\\":\\\"question\\\",\\\"options\\\":[{\\\"answer\\\":false,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>26</p>\\\",\\\"resvalue\\\":0,\\\"resindex\\\":0}},{\\\"answer\\\":true,\\\"value\\\":{\\\"type\\\":\\\"text\\\",\\\"body\\\":\\\"<p>24</p>\\\",\\\"resvalue\\\":1,\\\"resindex\\\":1}}],\\\"solutions\\\":[{\\\"id\\\":\\\"1\\\",\\\"value\\\":\\\"Solution as videoData\\\",\\\"type\\\":\\\"html/video\\\"}]}\"}}";
		Map<String, Object> externalPropMap = mapper.readValue(externalPropMapString, Map.class);
		PowerMockito.when(QuestionPaperGeneratorUtil.getExternalPropsData(Mockito.anyList())).thenReturn(externalPropMap);
		
		String childDataString = "{\"do_11293645874324275213\":3,\"do_11293645447181107211\":1,\"do_11293645469885235212\":2}";
		Map<String, Object> childData = mapper.readValue(childDataString, Map.class);
		
		Map<String, Object> assessmentMap = QuestionPaperGenerator.getAssessmentDataMap(childData);
		Assert.assertNotNull(assessmentMap);
		System.out.println(assessmentMap);
    }
}
